import{T as S,j as e,u as I,g as w,A as q}from"./index-DEypcd41.js";import{r as l,L as T}from"./react-vendor-Dn3TfeyG.js";import{I as D}from"./IndustrySelect-CNF1yHX3.js";import{B as M,X as U,A as C,p as B,R as O,a as P,N as Q,E as V,b as $}from"./icons-BuQqyrot.js";import"./charts-DCrIq4dL.js";import"./supabase-CDMW_bd0.js";const H=({company:r,isOpen:i,onClose:p,onComplete:u})=>{const h=l.useContext(S),[n,b]=l.useState(!1),[g,o]=l.useState(null),[a,c]=l.useState({name:"",industry:"",size:"",logo_url:""}),x=[{value:"1-50 employees",label:"Startup/Small (1-50 employees)"},{value:"51-200 employees",label:"Medium (51-200 employees)"},{value:"201-1000 employees",label:"Large (201-1000 employees)"},{value:"1000+ employees",label:"Enterprise (1000+ employees)"}];if(l.useEffect(()=>{r&&i&&(c({name:r.name,industry:r.industry,size:r.size,logo_url:r.logo_url||""}),o(null))},[r,i]),!i||!r)return null;const f=async t=>{t.preventDefault(),o(null),b(!0);try{if(!a.name.trim())throw new Error("Company name is required");if(!a.industry)throw new Error("Industry is required");if(!a.size)throw new Error("Company size is required");await I(r.id,{name:a.name.trim(),industry:a.industry,size:a.size,logo_url:a.logo_url.trim()||void 0}),h==null||h.addToast("Company updated successfully","success"),u()}catch(y){o(y instanceof Error?y.message:"Failed to update company")}finally{b(!1)}},m=()=>{n||(o(null),p())},j=a.name!==r.name||a.industry!==r.industry||a.size!==r.size||a.logo_url!==(r.logo_url||"");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Edit Company"})]}),e.jsx("button",{onClick:m,disabled:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200 disabled:opacity-50",children:e.jsx(U,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:f,className:"px-6 py-6",children:[g&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start space-x-3",children:[e.jsx(C,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700",children:g})]})]}),r.review_count>0&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg flex items-start space-x-3",children:[e.jsx(C,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Heads up!"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["This company has ",r.review_count," review",r.review_count!==1?"s":"",". Changes will be reflected on the public company profile."]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.name,onChange:t=>c({...a,name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n,required:!0,maxLength:100})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Industry ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{value:a.industry,onChange:t=>c({...a,industry:t})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Company Size ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:a.size,onChange:t=>c({...a,size:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n,required:!0,children:x.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo URL (Optional)"}),e.jsx("input",{type:"url",value:a.logo_url,onChange:t=>c({...a,logo_url:t.target.value}),placeholder:"https://example.com/logo.png",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n}),a.logo_url&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:a.logo_url,alt:"Logo preview",className:"w-16 h-16 rounded-lg object-cover border border-gray-200",onError:t=>{t.currentTarget.style.display="none"}})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reviews:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:r.review_count})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Average Rating:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:r.overall_rating.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:new Date(r.updated_at).toLocaleDateString()})]})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-end space-x-3 sticky bottom-0",children:[e.jsx("button",{type:"button",onClick:m,disabled:n,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors duration-200 font-medium disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:n||!j,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Changes"})]})})]})]})})},Z=()=>{const r=l.useContext(S),[i,p]=l.useState([]),[u,h]=l.useState([]),[n,b]=l.useState(!0),[g,o]=l.useState(!1),[a,c]=l.useState("all"),[x,f]=l.useState("all"),[m,j]=l.useState(""),[t,y]=l.useState(null),[E,v]=l.useState(!1);l.useEffect(()=>{N()},[]),l.useEffect(()=>{z()},[i,a,x,m]);const N=async()=>{try{const s=await w();p(s)}catch(s){console.error("Error fetching companies:",s),r==null||r.addToast("Failed to load companies","error")}finally{b(!1)}},_=async()=>{o(!0);try{const s=await w();p(s),r==null||r.addToast("Companies refreshed","success")}catch(s){console.error("Error refreshing companies:",s),r==null||r.addToast("Failed to refresh companies","error")}finally{o(!1)}},z=()=>{let s=[...i];if(a!=="all"&&(s=s.filter(d=>d.industry===a)),x!=="all"&&(s=s.filter(d=>d.size===x)),m.trim()){const d=m.toLowerCase();s=s.filter(A=>A.name.toLowerCase().includes(d))}h(s)},k=()=>{const s=new Set(i.map(d=>d.industry));return Array.from(s).sort()},F=()=>{const s=new Set(i.map(d=>d.size));return Array.from(s).sort()},L=s=>{y(s),v(!0)},R=async()=>{v(!1),await N()};return e.jsxs(q,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-green-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Manage Companies"}),e.jsx("p",{className:"text-gray-600",children:"View and edit company information"})]}),e.jsxs("button",{onClick:_,disabled:g,className:"mt-4 sm:mt-0 flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50",children:[e.jsx(O,{className:`w-4 h-4 ${g?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Companies"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:s=>j(s.target.value),placeholder:"Search by name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),e.jsxs("select",{value:a,onChange:s=>c(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Industries"}),k().map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Size"}),e.jsxs("select",{value:x,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Sizes"}),F().map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}),n&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Loading companies..."})]})}),!n&&e.jsx(e.Fragment,{children:u.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No companies found"}),e.jsx("p",{className:"text-gray-600",children:i.length===0?"No companies have been added yet.":"No companies match your current filters."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",u.length," of ",i.length," companies"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.industry}),e.jsx("p",{className:"text-sm text-gray-500",children:s.size})]}),s.logo_url&&e.jsx("img",{src:s.logo_url,alt:s.name,className:"w-12 h-12 rounded-lg object-cover"})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Rating:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-900",children:s.overall_rating.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reviews:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-900",children:s.review_count})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-gray-200",children:[e.jsxs(T,{to:`/company/${s.id}`,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"View"})]}),e.jsxs("button",{onClick:()=>L(s),className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]})]})]},s.id))})]})})]})}),e.jsx(H,{company:t,isOpen:E,onClose:()=>v(!1),onComplete:R})]})};export{Z as default};
