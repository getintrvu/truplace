import{j as e,b as X,f as Y,h as K}from"./index-erpD7sm0.js";import{u as Q,j as ee,r as c}from"./react-vendor-Dn3TfeyG.js";import{H as se,A as D,i as E,X as te,B as F,y as ae,g as re,C as ne,o as ie,b as le,z as A,G as oe,q as ce}from"./icons-BuQqyrot.js";import{D as me}from"./DomainInput-C8SWnfEv.js";import{I as de}from"./IndustrySelect-DVnxjWhL.js";import{P as ue}from"./ProgressBar-DxsF-ajT.js";import"./supabase-CDMW_bd0.js";const x=({label:l,required:u=!1,error:d,children:h,helpText:m})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[l,u&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m&&e.jsxs("div",{className:"group relative",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute right-0 top-6 w-64 p-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:m})]})]}),h,d&&e.jsxs("div",{className:"flex items-center space-x-1 text-red-600",children:[e.jsx(D,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:d})]})]}),he=({duplicates:l,onDismiss:u,onUseExisting:d,onContinueAnyway:h})=>l.length===0?null:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 animate-slide-up",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(E,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Similar companies found"}),e.jsx("button",{onClick:u,className:"text-yellow-600 hover:text-yellow-800 transition-colors duration-200",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-sm text-yellow-700 mb-3",children:["We found ",l.length," similar ",l.length===1?"company":"companies","that might match your request:"]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[l.slice(0,3).map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-md border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{className:"w-4 h-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:m.name}),m.industry&&e.jsx("p",{className:"text-sm text-gray-600",children:m.industry})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(m.similarity*100),"% match"]}),e.jsx("button",{onClick:()=>d(m),className:"text-blue-600 hover:text-blue-800 transition-colors duration-200",children:e.jsx(ae,{className:"w-4 h-4"})})]})]},m.id)),l.length>3&&e.jsxs("p",{className:"text-sm text-yellow-700",children:["...and ",l.length-3," more similar ",l.length-3===1?"company":"companies"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors duration-200 text-sm font-medium",children:"Continue with my request"}),e.jsx("button",{onClick:u,className:"flex-1 px-4 py-2 border border-yellow-300 text-yellow-800 rounded-md hover:bg-yellow-100 transition-colors duration-200 text-sm font-medium",children:"Let me review these first"})]})]})]})}),xe=({type:l,message:u,className:d=""})=>{const h=()=>{switch(l){case"success":return e.jsx(ne,{className:"w-4 h-4"});case"error":return e.jsx(D,{className:"w-4 h-4"});case"warning":return e.jsx(E,{className:"w-4 h-4"});case"info":return e.jsx(re,{className:"w-4 h-4"})}},m=()=>{switch(l){case"success":return"text-green-700 bg-green-50 border-green-200";case"error":return"text-red-700 bg-red-50 border-red-200";case"warning":return"text-yellow-700 bg-yellow-50 border-yellow-200";case"info":return"text-blue-700 bg-blue-50 border-blue-200"}};return e.jsxs("div",{className:`flex items-center space-x-2 p-3 border rounded-lg ${m()} ${d}`,children:[h(),e.jsx("span",{className:"text-sm",children:u})]})},Ne=()=>{const l=Q(),u=ee(),{fromReview:d,suggestedName:h}=u.state||{},[m,z]=c.useState(null),[L,T]=c.useState(!0),[w,N]=c.useState(!1),[B,v]=c.useState([]),[P,y]=c.useState(!1),[R,_]=c.useState(!1),[C,g]=c.useState(null),[n,b]=c.useState({company_name:h||"",company_website:"",email_domains:[],industry:"",company_size:"",description:"",justification:""}),[o,$]=c.useState({}),[S,j]=c.useState({}),W=[{value:"1-50 employees",label:"Startup/Small (1-50 employees)"},{value:"51-200 employees",label:"Medium (51-200 employees)"},{value:"201-1000 employees",label:"Large (201-1000 employees)"},{value:"1000+ employees",label:"Enterprise (1000+ employees)"}];c.useEffect(()=>{(async()=>{try{const s=await X();if(!s){l("/",{state:{message:"Please verify your email to request a company."}});return}if(z(s),s.email){const a=s.email.split("@")[1];a&&!n.email_domains.includes(a)&&b(r=>({...r,email_domains:[a]}))}}catch(s){console.error("Auth check failed:",s),l("/")}finally{T(!1)}})()},[l]);const k=c.useCallback((t,s)=>{switch(t){case"company_name":return!s||s.trim().length<2?"Company name must be at least 2 characters":s.trim().length>100?"Company name must be less than 100 characters":"";case"company_website":return!s||!s.trim()?"Company website is required":/^https?:\/\/.+\..+/.test(s)?"":"Please enter a valid website URL (e.g., https://company.com)";case"email_domains":if(!Array.isArray(s)||s.length===0)return"At least one email domain is required";const r=/^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]?\.[a-zA-Z]{2,}$/,i=s.find(J=>!r.test(J));return i?`Invalid domain format: ${i}`:"";case"industry":return!s||!s.trim()?"Please select an industry":"";case"company_size":return!s||!s.trim()?"Please select company size":"";case"description":return s&&s.length>500?"Description must be less than 500 characters":"";case"justification":return s&&s.length>300?"Justification must be less than 300 characters":"";default:return""}},[]);c.useEffect(()=>{const t={};Object.keys(n).forEach(s=>{const a=s;if(S[a]){const r=k(a,n[a]);r&&(t[a]=r)}}),$(t)},[n,S,k]);const I=t=>{let s=t.trim();s&&!s.startsWith("http://")&&!s.startsWith("https://")&&(s="https://"+s),b(a=>({...a,company_website:s}));try{const r=new URL(s).hostname.replace("www.","");r&&!n.email_domains.includes(r)&&setTimeout(()=>{window.confirm(`Would you like to add "${r}" to your email domains?`)&&b(i=>({...i,email_domains:[...i.email_domains,r]}))},500)}catch{}};c.useEffect(()=>{const s=setTimeout(async()=>{if(n.company_name.length>2){_(!0);try{const r=(await Y(n.company_name,n.company_website)).map(i=>({...i,similarity:U(n.company_name,i.name)})).filter(i=>i.similarity>.6);v(r),y(r.length>0)}catch(a){console.error("Duplicate detection failed:",a)}finally{_(!1)}}else v([]),y(!1)},800);return()=>clearTimeout(s)},[n.company_name,n.company_website]);const U=(t,s)=>{const a=t.length>s.length?t:s,r=t.length>s.length?s:t;if(a.length===0)return 1;const i=H(a.toLowerCase(),r.toLowerCase());return(a.length-i)/a.length},H=(t,s)=>{const a=[];for(let r=0;r<=s.length;r++)a[r]=[r];for(let r=0;r<=t.length;r++)a[0][r]=r;for(let r=1;r<=s.length;r++)for(let i=1;i<=t.length;i++)s.charAt(r-1)===t.charAt(i-1)?a[r][i]=a[r-1][i-1]:a[r][i]=Math.min(a[r-1][i-1]+1,a[r][i-1]+1,a[r-1][i]+1);return a[s.length][t.length]},p=(t,s)=>{b(a=>({...a,[t]:s})),j(a=>({...a,[t]:!0})),g(null)},f=t=>{j(s=>({...s,[t]:!0}))},M=()=>{const t=["company_name","company_website","email_domains","industry","company_size"];return t.filter(a=>{const r=n[a];return Array.isArray(r)?r.length>0:!!r}).length/t.length*100},q=()=>{const s=["company_name","company_website","email_domains","industry","company_size"].every(r=>{const i=n[r];return Array.isArray(i)?i.length>0:!!i}),a=Object.keys(o).length===0;return s&&a},O=async t=>{t.preventDefault();const s=Object.keys(n);if(j(s.reduce((a,r)=>({...a,[r]:!0}),{})),!q()){g("Please fix the errors above before submitting.");return}N(!0),g(null);try{const a=await K(n);l("/company-requested",{state:{requestId:a.id,companyName:a.company_name}})}catch(a){console.error("Submission failed:",a),g(a instanceof Error?a.message:"Failed to submit request. Please try again.")}finally{N(!1)}},Z=t=>{l(`/company/${t.id}`)},V=()=>{y(!1)},G=()=>{y(!1)};return L?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/4 mb-8"}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm mb-8",children:[e.jsx("div",{className:"h-12 bg-gray-300 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("button",{onClick:()=>l(d?"/submit-review":"/"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors duration-200",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:d?"Back to Review":"Back to Home"})]})}),d&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-1",children:"Requesting company to write a review"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Once your company request is approved, you'll receive an email notification with a link to submit your review. This typically takes 24-48 hours."})]})]})}),e.jsx(ue,{progress:M(),title:"Request New Company",subtitle:"Help us expand our database by suggesting your company"}),P&&e.jsx(he,{duplicates:B,onDismiss:G,onUseExisting:Z,onContinueAnyway:V}),e.jsxs("form",{onSubmit:O,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Company Information"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Tell us about the company you'd like to add to our platform"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(x,{label:"Company Name",required:!0,error:o.company_name,helpText:"Enter the official company name as it appears on their website",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:n.company_name,onChange:t=>p("company_name",t.target.value),onBlur:()=>f("company_name"),placeholder:"Enter company name",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${o.company_name?"border-red-300 bg-red-50":"border-gray-300"}`}),R&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(A,{className:"w-4 h-4 animate-spin text-gray-400"})})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[n.company_name.length,"/100 characters"]})]})}),e.jsx(x,{label:"Company Website",required:!0,error:o.company_website,helpText:"The main company website URL",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:n.company_website,onChange:t=>I(t.target.value),onBlur:()=>f("company_website"),placeholder:"https://company.com",className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${o.company_website?"border-red-300 bg-red-50":"border-gray-300"}`})]})}),e.jsx(x,{label:"Industry",required:!0,error:o.industry,helpText:"Select the primary industry this company operates in",children:e.jsx(de,{value:n.industry,onChange:t=>p("industry",t),error:o.industry})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(x,{label:"Email Domains",required:!0,error:o.email_domains,helpText:"Email domains used by employees (e.g., company.com, subsidiary.com)",children:e.jsx(me,{domains:n.email_domains,onChange:t=>p("email_domains",t),error:o.email_domains,placeholder:"Enter email domain (e.g., company.com)"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Company Details"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Additional information to help us categorize and verify the company"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{label:"Company Size",required:!0,error:o.company_size,helpText:"Approximate number of employees",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:W.map(t=>e.jsxs("label",{className:`relative flex items-center p-4 border rounded-lg cursor-pointer transition-all duration-200 ${n.company_size===t.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"company_size",value:t.value,checked:n.company_size===t.value,onChange:s=>p("company_size",s.target.value),className:"sr-only"}),e.jsx("div",{className:`w-4 h-4 rounded-full border-2 mr-3 flex items-center justify-center ${n.company_size===t.value?"border-blue-500":"border-gray-300"}`,children:n.company_size===t.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.label})]},t.value))})}),e.jsxs(x,{label:"Company Description",error:o.description,helpText:"Brief description of what the company does (optional)",children:[e.jsx("textarea",{value:n.description,onChange:t=>p("description",t.target.value),onBlur:()=>f("description"),placeholder:"Brief description of what this company does...",rows:4,maxLength:500,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none ${o.description?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[n.description.length,"/500 characters"]})]}),e.jsxs(x,{label:"Reason for Addition",error:o.justification,helpText:"Help us understand why this company should be added (optional)",children:[e.jsx("textarea",{value:n.justification,onChange:t=>p("justification",t.target.value),onBlur:()=>f("justification"),placeholder:"Help us understand why this company should be added to our platform...",rows:3,maxLength:300,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none ${o.justification?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[n.justification.length,"/300 characters"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[C&&e.jsx("div",{className:"mb-4",children:e.jsx(xe,{type:"error",message:C})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Your request will be reviewed within 48 hours."}),e.jsx("p",{children:"We'll notify you via email once it's processed."})]}),e.jsx("button",{type:"submit",disabled:!q()||w,className:"w-full sm:w-auto bg-gradient-to-r from-blue-600 to-green-500 text-white px-8 py-3 rounded-lg font-medium hover:shadow-lg hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:shadow-none flex items-center justify-center space-x-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Submitting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Submit Request"})]})})]})]})]})]})})};export{Ne as default};
